require=function o(a,c,r){function h(t,e){if(!c[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var s=c[t]={exports:{}};a[t][0].call(s.exports,function(e){return h(a[t][1][e]||e)},s,s.exports,o,a,c,r)}return c[t].exports}for(var l="function"==typeof require&&require,e=0;e<r.length;e++)h(r[e]);return h}({Defense:[function(e,t,i){"use strict";cc._RF.push(t,"9f28a4vQuFLHoZAT/jmtbZM","Defense");var n=e("Resource");cc.Class({extends:n,properties:{},start:function(){},die:function(){this._super();var e=function(){this.node.destroy()}.bind(this);this.node.setColor(cc.Color.WHITE);var t=cc.sequence(cc.tintTo(.5,255,0,0),cc.tintTo(.5,255,255,255),cc.callFunc(e));this.node.runAction(t)},update:function(e){}});cc._RF.pop()},{Resource:"Resource"}],Drone:[function(e,t,i){"use strict";cc._RF.push(t,"d8521eGHLxPWJZAIeO0y9Ki","Drone");var n=e("Defense");cc.Class({extends:n,properties:{startTranslationAngle:{default:0},translationSpeed:{default:3},translationRadius:{default:200},rotationSpeed:{default:100},crosshairPrefab:{default:null,type:cc.Prefab},_crosshair:{default:null,type:cc.Node}},onLoad:function(){this._crosshair=cc.instantiate(this.crosshairPrefab),this._crosshair.parent=this.node.parent},start:function(){this.threat=null,this.turret=this.node.getChildByName("turret"),this._cTime=0,this._timeout=3,this.threatList=[],this.cTranslationAngle=this.startTranslationAngle,this.metralhadoraAction=cc.sequence(cc.callFunc(this.atirar,this),cc.delayTime(.4),cc.callFunc(this.atirar,this),cc.delayTime(.4),cc.callFunc(this.atirar,this))},lockOn:function(e){var t=Math.atan2(e.y-this.node.y,e.x-this.node.x);return this._crosshair.opacity=255,this._crosshair.position=e,cc.radiansToDegrees(-t)+90},mirar:function(e,t){e>this.turret.rotation?this.turret.rotation+=this.rotationSpeed*t:e<this.turret.rotation&&(this.turret.rotation-=this.rotationSpeed*t)},atirar:function(){this.game.spawnProjectile(this.turret)},onCollisionEnter:function(e,t){console.log("(DEFENSE) colidiu"),console.log("(DEFENSE) GROUP: "+e.node.group),console.log("(DEFENSE) TAG: "+e.tag),console.log("(DEFENSE) SELF TAG: "+t.tag),"ameaça"==e.node.group&&1==t.tag&&(e.node.getComponent("Threat").explosivel||(this.threatList.length<=0&&(this.threat=e.node),this.threatList.push(e.node)))},onCollisionExit:function(e,t){this.removeThreatFromList(e.node),e.node==this.threat&&(this.threat=this.threatList.pop())},removeThreatFromList:function(e){for(var t=0,i=this.threatList.length;t<i;t++)e==this.threatList[t]&&this.threatList.splice(t,1)},update:function(e){this.node.position=cc.p(Math.cos(cc.degreesToRadians(this.cTranslationAngle))*this.translationRadius,Math.sin(cc.degreesToRadians(this.cTranslationAngle))*this.translationRadius),this.cTranslationAngle+=this.translationSpeed*e,360<this.cTranslationAngle&&(this.cTranslationAngle=0),this.threat?(this.mirar(this.lockOn(this.threat.getPosition()),e),this._cTime+=e,this._cTime>=this._timeout&&(this.atirar(),this._cTime=0)):this._crosshair.opacity=0},onDestroy:function(){this._crosshair.destroy()}});cc._RF.pop()},{Defense:"Defense"}],Fragment:[function(e,t,i){"use strict";cc._RF.push(t,"e29b4Tn6LVF4pCm+m4ujHD0","Fragment");var n=e("Threat");cc.Class({extends:n,properties:{},init:function(e){this.game=e,this.initMotion()},initMotion:function(){var e=Math.round(30*cc.random0To1()+70),t=Math.round(360*cc.random0To1()+0),i=cc.p(Math.cos(cc.degreesToRadians(t))*e,Math.sin(cc.degreesToRadians(t))*e),n=cc.pDistance(this.node.position,cc.p(i.x+this.node.x,i.y+this.node.y))/this.speed,s=cc.moveBy(n,i),o=cc.fadeOut(n),a=function(){console.log("destroyed"),this.game.onThreatDestroy(this),this.node.destroy()}.bind(this),c=cc.sequence(s,cc.callFunc(a));cc.find("sprite",this.node).runAction(o),this.node.runAction(c)},update:function(e){}});cc._RF.pop()},{Threat:"Threat"}],InterScenes:[function(e,t,i){"use strict";cc._RF.push(t,"ac7574dpclGGbeGiXp8fuOT","InterScenes"),t.exports={waveDataNameList:null,levelID:null,upgradeRapidLaser:null,upgradeDefaultLaser:null},cc._RF.pop()},{}],LevelItem:[function(e,t,i){"use strict";cc._RF.push(t,"4e6a9A6yWlHFpUxISpUW44U","LevelItem"),cc.Class({extends:cc.Component,properties:{disponivel:{default:!0},levelID:{default:0},levelName:{default:""},_ultimaPontuacao:{default:0},_melhorPontuacao:{default:0},lblUltimaPontuacao:{default:null,type:cc.Label},lblMelhorPontuacao:{default:null,type:cc.Label},lblName:{default:null,type:cc.Label},lblNumber:{default:null,type:cc.Label},lblRequirement:{default:null,type:cc.Label},waveDataNameList:{default:[],type:[cc.String],tooltip:'Forneça uma sequencia de nomes de arquivos json com os dados da wave, eles devem ser encontrados na pasta "assets/resources/"'},_selected:!1},onLoad:function(){this.main=cc.find("MainScript").getComponent("MainLS"),this.node.on("mousedown",function(e){this.main.selectScene(this)}.bind(this))},init:function(e,t){this.levelID=e.id,this.levelName=e.name,this.lblUltimaPontuacao.string=e.last,this.lblMelhorPontuacao.string=e.best,this.lblName.string=this.levelName,this.lblNumber.string=("000"+e.id).slice(-3),this.lblRequirement.string=e.requirement?e.requirement:0,this.waveDataNameList=e.wave,this.disponivel=e.disponivel,this._selected=e.selected,this._selected&&this.select(),e.requirement&&t>=e.requirement&&(this.disponivel=!0)},start:function(){},unselect:function(){var e=this.getComponent(cc.Animation);e.setCurrentTime(0),e.stop()},select:function(){this.getComponent(cc.Animation).play()}}),cc._RF.pop()},{}],MainLS:[function(e,t,i){"use strict";cc._RF.push(t,"453bfdEGc5FDa07QX0rQVWZ","MainLS");var n=e("InterScenes"),s=e("LevelItem");cc.Class({extends:cc.Component,properties:{grid:{default:null,type:cc.Node},levelPrefab:{default:null,type:cc.Prefab},currentLevelSelected:{default:null,type:s}},selectScene:function(e){e.disponivel&&(n.waveDataNameList=e.waveDataNameList,n.levelID=e.levelID,n.upgradeRapidLaser=this._upgradeRapidLaser,n.upgradeDefaultLaser=this._upgradeDefaultLaser,cc.director.loadScene("main"))},nextItem:function(){var e=this.currentLevelSelected.node.getSiblingIndex()+1,t=this.grid.children[e];if(t){var i=t.getComponent("LevelItem");this.currentLevelSelected.unselect(),this.currentLevelSelected=i,this.currentLevelSelected.select()}},previousItem:function(){var e=this.currentLevelSelected.node.getSiblingIndex()-1,t=this.grid.children[e];if(t){var i=t.getComponent("LevelItem");this.currentLevelSelected.unselect(),this.currentLevelSelected=i,this.currentLevelSelected.select()}},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this._carregarLevels()},_carregarLevels:function(){if(!cc.sys.localStorage.getItem("levelsData")){var e={levels:[{id:1,name:"Level One",last:0,best:0,wave:["single","wave1"],disponivel:!0,selected:!0},{id:2,name:"Level Two",last:0,best:0,wave:["wave1","wave1"],disponivel:!0,selected:!1},{id:3,name:"Level Three",last:0,best:0,wave:["wave1","wave2"],disponivel:!1,selected:!1,requirement:800}]};cc.sys.localStorage.setItem("levelsData",JSON.stringify(e))}e=JSON.parse(cc.sys.localStorage.getItem("levelsData"));for(var t=0,i=0;i<e.levels.length;i++){var n=e.levels[i];t+=n.best;var s=cc.instantiate(this.levelPrefab),o=s.getComponent("LevelItem");o.init(n,t),n.selected&&(this.currentLevelSelected=o),this.grid.insertChild(s)}this._pontosAcumulados=t},start:function(){cc.find("Canvas/pontos").getComponent(cc.Label).string=this._pontosAcumulados,cc.find("Canvas/laserDuplo/pontos1").getComponent(cc.Label).string=900,cc.find("Canvas/laserPierce/pontos1").getComponent(cc.Label).string=1800,this._upgradeRapidLaser=900<this._pontosAcumulados,this._upgradeDefaultLaser=1800<this._pontosAcumulados},onKeyDown:function(e){switch(e.keyCode){case cc.KEY.enter:case cc.KEY.space:this.selectScene(this.currentLevelSelected);break;case cc.KEY.a:case cc.KEY.left:this.previousItem();break;case cc.KEY.d:case cc.KEY.right:this.nextItem();break;case cc.KEY.w:case cc.KEY.up:break;case cc.KEY.s:case cc.KEY.down:}},onKeyUp:function(e){switch(e.keyCode){case cc.KEY.enter:case cc.KEY.space:console.log("Press a key");break;case cc.KEY.a:case cc.KEY.left:break;case cc.KEY.d:case cc.KEY.right:break;case cc.KEY.w:case cc.KEY.up:break;case cc.KEY.s:case cc.KEY.down:}},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)}});cc._RF.pop()},{InterScenes:"InterScenes",LevelItem:"LevelItem"}],Main:[function(e,t,i){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","Main");var l=e("InterScenes"),n=cc.Class({extends:cc.Component,properties:{turret:{default:null,type:cc.Node},turretAtlas:{default:null,type:cc.SpriteAtlas},rotationSpeed:{default:1},defaultLaserReloadTime:{default:0,tooltip:"Reload Time do Laser Default"},otherLaserReloadTime:{default:0,tooltip:"Reload Time do Laser Rápido"},boostTime:{default:1,displayName:"Reload Time Boost",tooltip:"Reload Time Boost"},laserPrefab:{default:null,type:cc.Prefab},otherLaserPrefab:{default:[],type:[cc.Prefab]},shieldPrefab:{default:null,type:cc.Prefab},dronePrefab:{default:null,type:cc.Prefab},waveDataNameList:{default:[],type:[cc.String],tooltip:'Forneça uma sequencia de nomes de arquivos json com os dados da wave, eles devem ser encontrados na pasta "assets/resources/"'},_cTime:0,points:{get:function(){return this._points},set:function(e){this._points=e<0?0:e},visible:!1},_gameOver:!1},statics:{LASER_DEFAULT:-1,LASER_RAPID1:0,LASER_RAPID2:1,LASER_DEFAULT1:2},onLoad:function(){cc.director.getCollisionManager().enabled=!0,this.reloadBar=cc.find("Canvas/Interface/reloadBar").getComponent(cc.ProgressBar),this.avatar=cc.find("Canvas/avatar"),this.city=cc.find("Canvas/city"),this.defense_facility=cc.find("Canvas/defense_facility"),this.power_plant=cc.find("Canvas/power_plant"),this.planet=cc.find("Canvas/planet"),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this._onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this._onKeyUp,this),this.node.on(cc.Node.EventType.MOUSE_DOWN,this._onClick,this),this.waveDataNameList=l.waveDataNameList.slice(0)},start:function(){this.avatar.getComponent("Resource").init(this),this.city.getComponent("Resource").init(this),this.defense_facility.getComponent("Resource").init(this),this.power_plant.getComponent("Resource").init(this),this.rotateLeft=!1,this.rotateRight=!1,this.shootPermit=!1,this.upgradeRapidLaser=l.upgradeRapidLaser,this.upgradeDefaultLaser=l.upgradeDefaultLaser,this.projectileActiveCode=this.upgradeDefaultLaser?n.LASER_DEFAULT1:n.LASER_DEFAULT,this.reloadTime=this.defaultLaserReloadTime,this.currentBoostTime=1,this._carregarMunicao=!0,this.numberOfWaves=this.waveDataNameList.length,this.currentWaveIdx=0,this.points=0,this._cTime=this.reloadTime,this.startNewWave()},_loadWaveAndProcessIt:function(e){cc.loader.loadRes(e,function(e,t){this.currentWave=this.getComponent("Wave"),this.currentWave.init(t),console.log("(WAVE) remaining threats: "+this.currentWave.remainingThreats),this._processWave(),this.updateInterface()}.bind(this))},_processWave:function(){var e=this.currentWave.extractThreat();e&&this.spawnThreat(e);var i=function(){var e=this.currentWave.extractThreat();if(e&&this.spawnThreat(e),console.log("(WAVE) remaining threats: "+this.currentWave.remainingThreats),this.currentWave.waveIsOver())console.log("(WAVE) Wave Is Over"),this.node.stopAllActions(),this.onCurrentWaveOver();else{var t=cc.sequence(cc.delayTime(Number(e.interval)),cc.callFunc(i));this.node.runAction(t)}}.bind(this),t=cc.sequence(cc.delayTime(Number(e.interval)),cc.callFunc(i));this.node.runAction(t)},getPositionInOtherNode:function(e,t){if(null==t.parent)return null;var i=t.parent.convertToWorldSpaceAR(t.getPosition());return e.convertToNodeSpaceAR(i)},returnToLevelSelect:function(){cc.director.loadScene("select_level")},applyEffects:function(){var e=this.avatar.getComponent("Resource"),t=this.city.getComponent("Resource"),i=this.defense_facility.getComponent("Resource"),n=this.power_plant.getComponent("Resource");(e.died||t.died&&i.died&&n.died)&&(this._gameOver=!0);var s=0;s+=t.died?0:1,s+=i.died?0:1,s+=n.died?0:1;var o=this.points*s,a={};if(a.pontos=this.points,a.numRecursos=s,a.total=o,this.points=o,0==this.waveDataNameList.length){for(var c=JSON.parse(cc.sys.localStorage.getItem("levelsData")),r=0;r<c.levels.length;r++){var h=c.levels[r];h.id==l.levelID&&(this.points>h.best&&(h.best=this.points),h.last=this.points)}cc.sys.localStorage.setItem("levelsData",JSON.stringify(c))}this._showEndWaveInterface(a)},startNewWave:function(){var e=this.waveDataNameList.shift();console.log("(NEW WAVE) STARTING NEW WAVE"),console.log("(NEW WAVE) WAVE NAME: "+e),e&&(this.currentWaveIdx++,this._loadWaveAndProcessIt(e),this.schedule(this._verifySpace,.5))},switchLaser:function(){switch(this.projectileActiveCode){case n.LASER_DEFAULT:case n.LASER_DEFAULT1:this.turret.getComponent(cc.Sprite).spriteFrame=this.turretAtlas.getSpriteFrame("turret_w2"),this.projectileActiveCode=this.upgradeRapidLaser?n.LASER_RAPID2:n.LASER_RAPID1,this.reloadTime=this.otherLaserReloadTime;break;case n.LASER_RAPID1:case n.LASER_RAPID2:this.turret.getComponent(cc.Sprite).spriteFrame=this.turretAtlas.getSpriteFrame("turret_w1"),this.projectileActiveCode=this.upgradeDefaultLaser?n.LASER_DEFAULT1:n.LASER_DEFAULT,this.reloadTime=this.defaultLaserReloadTime}this.shootPermit=!1,this._cTime=0},cleanSpace:function(){this.node.children.forEach(function(e){e.getComponent("Fragment")&&(e.stopAllActions(),e.destroy())},this)},_haveFragments:function(){for(var e=this.node.children.length,t=0;t<e;t++){var i=this.node.children[t];if(i.getComponent("Fragment")&&cc.isValid(i))return!0}return!1},spawnProjectile:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=e||this.turret;if(t)var s=cc.instantiate(this.otherLaserPrefab[i]),o=n.getChildByName("init_pos2");else s=cc.instantiate(this.laserPrefab),o=n.getChildByName("init_pos");var a=n.getChildByName("mira");s.setPosition(this.getPositionInOtherNode(this.node,o)),s.setRotation(n.getRotation()+180),s.setScale(.5,.5),s.getComponent("Projectile").init(this,this.getPositionInOtherNode(this.node,a),n),this.node.insertChild(s,cc.find("Canvas/Interface").getSiblingIndex())},spawnThreat:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if("Spaceship"!=e.getComponent("Threat").tipo){var i=0;if(isNaN(e.angle)){i=Math.round(1*cc.random0To1())?Math.round(80*cc.random0To1()+325):Math.round(90*cc.random0To1()+135)}else{var n=Math.round(5*cc.randomMinus1To1());i=e.angle+n}if(console.log("random_angle:"+i),t)s=this.getPositionInOtherNode(this.node,t);else var s=cc.p(600*Math.cos(cc.degreesToRadians(i)),600*Math.sin(cc.degreesToRadians(i)));console.log("init_pos:"+s),e.setPosition(s),e.setScale(.5,.5),"Asteroid"!=e.getComponent("Threat").tipo&&(e.setScale(1,1),e.getChildByName("sprite").setRotation(-1*i-90)),this.node.insertChild(e,cc.find("Canvas/Interface").getSiblingIndex()),e.getComponent("Threat").init(this)}else this.spawnSpaceship(e)},spawnAsteroidFragments:function(e){var t=e.node.getPosition(),i=this.getComponent("Wave").asteroidFragmentsPrefab.slice(0),n=Math.round(cc.random0To1()*(i.length-1-0)+0),s=cc.instantiate(i[n]);i.slice(n,1),n=Math.round(cc.random0To1()*(i.length-1-0)+0);var o=cc.instantiate(i[n]);i.slice(n,1),n=Math.round(cc.random0To1()*(i.length-1-0)+0);var a=cc.instantiate(i[n]);i.slice(n,1),s.setPosition(t),o.setPosition(t),a.setPosition(t),s.setScale(.5,.5),o.setScale(.5,.5),a.setScale(.5,.5),this.node.insertChild(s,cc.find("Canvas/Interface").getSiblingIndex()),this.node.insertChild(o,cc.find("Canvas/Interface").getSiblingIndex()),this.node.insertChild(a,cc.find("Canvas/Interface").getSiblingIndex());var c=Math.round(e.getCurrentPointsAccordingToPos());s.getComponent("Fragment").tipo="Fragment",s.getComponent("Fragment").speed=20,s.getComponent("Fragment").pontos=c,s.getComponent("Fragment").maxHP=1,s.getComponent("Fragment").hp=1,o.getComponent("Fragment").tipo="Fragment",o.getComponent("Fragment").speed=20,o.getComponent("Fragment").pontos=c,o.getComponent("Fragment").maxHP=1,o.getComponent("Fragment").hp=1,a.getComponent("Fragment").tipo="Fragment",a.getComponent("Fragment").speed=20,a.getComponent("Fragment").pontos=c,a.getComponent("Fragment").maxHP=1,a.getComponent("Fragment").hp=1,s.getComponent("Fragment").init(this),o.getComponent("Fragment").init(this),a.getComponent("Fragment").init(this)},spawnSpaceship:function(e){var t=e.getComponent("Spaceship");e.setScale(.5,.5),t.init(this,e.shipPos),t.beginMotion(),this.node.insertChild(e,cc.find("Canvas/Interface").getSiblingIndex())},spawnShield:function(){if(!cc.find("Canvas/shield")){var e=cc.instantiate(this.shieldPrefab);e.getComponent("Resource").init(this),this.updateInterface(e.getComponent("Resource")),this.node.insertChild(e,cc.find("Canvas/Interface").getSiblingIndex())}},spawnDrone:function(){var i=[0,90,180,270];if(this.node.children.forEach(function(e){if("spaceBuilding_014"==e.name){var t=e.getComponent("Drone");i.splice(i.indexOf(t.startTranslationAngle),1)}},this),0<i.length){var e=cc.instantiate(this.dronePrefab),t=i[Math.round(cc.random0To1()*(i.length-1))];e.getComponent("Drone").init(this),e.getComponent("Drone").startTranslationAngle=t,this.updateInterface(e.getComponent("Resource")),this.node.insertChild(e,cc.find("Canvas/Interface").getSiblingIndex())}},spawnThreatRandTarget:function(){var e=[this.defense_facility,this.power_plant,this.city],t=Math.round(2*cc.random0To1());this.spawnThreat(e[t])},onThreatHit:function(){this.reloadBar.node.getChildByName("bar").setColor(cc.Color.GREEN),this.currentBoostTime=this.boostTime},onDamage:function(e,t){var i=t.getComponent("Resource");switch(e.tipo){case"Virus":case"EMP":break;case"EnemyProjectile":if("avatar"==t.name){var n=function(){this._carregarMunicao=!1,this.shootPermit=!1,this._cTime=0,this.currentBoostTime=1,this.reloadBar.progress=0,this.reloadBar.node.getChildByName("bar").setColor(cc.Color.WHITE),this.turret.setOpacity(150)}.bind(this),s=function(){this._carregarMunicao=!0,this.turret.setOpacity(255)}.bind(this),o=cc.sequence(cc.callFunc(n),cc.delayTime(2),cc.callFunc(s));this.node.runAction(o)}}i.damage(),this.updateInterface(i)},onThreatDestroy:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(i)switch(i.owner.name){case"spaceBuilding_014":this.points+=Math.round(.5*t);break;case"turret":this.points+=Math.round(t)}else this.points+=n?Math.round(1.3*t):Math.round(t);(!e||"EnemyProjectile"!=e.tipo&&"Fragment"!=e.tipo)&&this.currentWave.onThreatDestroy(),this.updateInterface(),"Asteroid"==e.tipo&&i&&this.spawnAsteroidFragments(e)},onResourceDie:function(e){console.log(e.name+" died =´("),e.node==this.avatar&&(this._carregarMunicao=!1,this.shootPermit=!1,this._cTime=0,this.currentBoostTime=1,this.reloadBar.progress=0,this.reloadBar.node.getChildByName("bar").setColor(cc.Color.WHITE))},onResourceRevived:function(e){console.log(e.node.name+" revived!! =D"),e.node==this.avatar&&(this._carregarMunicao=!0)},onCurrentWaveOver:function(){},onWaveDestroyed:function(){this.cleanSpace(),this.unschedule(this._verifySpace),this.applyEffects()},onFail:function(){this.cleanSpace(),this.unschedule(this._verifySpace),this.applyEffects()},update:function(e){this.rotateLeft&&(this.turret.rotation-=this.rotationSpeed*e),this.rotateRight&&(this.turret.rotation+=this.rotationSpeed*e),this._carregarMunicao&&(this._cTime+=e*this.currentBoostTime,this.reloadBar.progress=this._cTime/this.reloadTime,this._cTime>=this.reloadTime&&(this.shootPermit=!0,this._cTime=this.reloadTime))},_verifySpace:function(){var e=this.avatar.getComponent("Resource"),t=this.city.getComponent("Resource"),i=this.defense_facility.getComponent("Resource"),n=this.power_plant.getComponent("Resource");e.died||t.died&&i.died&&n.died?this.onFail():this.currentWave.waveDestroyed()&&!this._haveFragments()&&this.onWaveDestroyed()},updateInterface:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=cc.find("Canvas/Interface");cc.find("interface/hp/data",this.defense_facility).getComponent(cc.Label).string=this.defense_facility.getComponent("Resource").hp,cc.find("interface/hp/data",this.power_plant).getComponent(cc.Label).string=this.power_plant.getComponent("Resource").hp,cc.find("interface/hp/data",this.city).getComponent(cc.Label).string=this.city.getComponent("Resource").hp,cc.find("ifPlayer/layout/data",t).getComponent(cc.Label).string=this.avatar.getComponent("Resource").hp,cc.find("ifWave/layout/waveNum/data",t).getComponent(cc.Label).string=this.currentWaveIdx+"/"+this.numberOfWaves,cc.find("ifWave/layout/waveThreats/data",t).getComponent(cc.Label).string=this.currentWave.numberOfThreats-this.currentWave.threatsDestroyed+"/"+this.currentWave.numberOfThreats;var i=("0000000000"+this.points).slice(-8);cc.find("ifPoints/layout/data",t).getComponent(cc.Label).string=i,!e||"spaceBuilding_014"!=e.node.name&&"shield"!=e.node.name||(cc.find("interface/hp/data",e.node).getComponent(cc.Label).string=e.hp)},_showEndWaveInterface:function(e){var t=cc.find("Canvas/Interface/ifEndWave");if(cc.find("layout/data/values/txtPts",t).getComponent(cc.Label).string=e.pontos,cc.find("layout/data/values/txtNR",t).getComponent(cc.Label).string=e.numRecursos,cc.find("layout/data/values/txtTotal",t).getComponent(cc.Label).string=e.total,0==this.waveDataNameList.length||this._gameOver){var i=cc.find("layout/buttons/close",t);cc.find("label",i).getComponent(cc.Label).string="Restart",i.getComponent(cc.Button).clickEvents[0].customEventData="restart"}t.setPosition(0,0)},hideEndWaveInterface:function(e,t){"restart"!=t?(cc.find("Canvas/Interface/ifEndWave").setPosition(1e3,0),this._gameOver||this.startNewWave()):cc.director.loadScene("main")},addShield:function(){this.spawnShield()},addDrone:function(){this.spawnDrone()},_onKeyDown:function(e){switch(e.keyCode){case cc.KEY.a:console.log("key a"),this.rotateLeft=!0,this.rotateRight=!1;break;case cc.KEY.d:console.log("key d"),this.rotateRight=!0,this.rotateLeft=!1;break;case cc.KEY.r:this.switchLaser();break;case cc.KEY.space:if(console.log("key space"),this.shootPermit){switch(this.projectileActiveCode){case n.LASER_RAPID1:case n.LASER_RAPID2:case n.LASER_DEFAULT1:this.spawnProjectile(null,!0,this.projectileActiveCode);break;default:case n.LASER_DEFAULT:this.spawnProjectile()}this.shootPermit=!1,this._cTime=0,this.currentBoostTime=1,this.reloadBar.node.getChildByName("bar").setColor(cc.Color.WHITE)}else console.log("nao permitido");break;case cc.KEY.b:this.returnToLevelSelect()}},_onKeyUp:function(e){switch(e.keyCode){case cc.KEY.a:console.log("release a"),this.rotateLeft=!1;break;case cc.KEY.d:console.log("release d"),this.rotateRight=!1;break;case cc.KEY.space:console.log("release space")}},_onClick:function(e){if(this.shootPermit){switch(this.projectileActiveCode){case n.LASER_RAPID1:case n.LASER_RAPID2:case n.LASER_DEFAULT1:this.spawnProjectile(null,!0,this.projectileActiveCode);break;default:case n.LASER_DEFAULT:this.spawnProjectile()}this.shootPermit=!1,this._cTime=0,this.currentBoostTime=1,this.reloadBar.node.getChildByName("bar").setColor(cc.Color.WHITE)}else console.log("nao permitido")}});cc._RF.pop()},{InterScenes:"InterScenes"}],Pierce:[function(e,t,i){"use strict";cc._RF.push(t,"e9f3b3SewlIuL0g/aXldlSq","Pierce");var n=e("Threat"),s=e("Projectile");cc.Class({extends:s,properties:{pierces:{default:1}},start:function(){this._pierces=0},init:function(e,t,i){this._super(e,t,i)},onCollisionEnter:function(e,t){"ameaça"==e.node.group&&e.tag!=n.TAG_EXPLOSION&&(this.game.onThreatHit(),this._pierces++>=this.pierces&&this.node.destroy())}}),cc._RF.pop()},{Projectile:"Projectile",Threat:"Threat"}],Projectile:[function(e,t,i){"use strict";cc._RF.push(t,"5f897B3TI5EQbzSvim2NxHT","Projectile");var n=e("Threat");cc.Class({extends:cc.Component,properties:{speed:{default:1},dano:{default:10},owner:{default:null,type:cc.Node,visible:!1}},start:function(){},init:function(e,t,i){this.game=e,this.owner=i;var n=cc.pDistance(this.node.position,t)/this.speed,s=cc.moveTo(n,t),o=this,a=cc.sequence(s,cc.callFunc(function(){console.log("destroyed"),o.node.destroy()}));this.node.runAction(a)},onCollisionEnter:function(e,t){"ameaça"==e.node.group&&e.tag!=n.TAG_EXPLOSION&&(this.game.onThreatHit(),this.node.destroy())},update:function(e){}}),cc._RF.pop()},{Threat:"Threat"}],Resource:[function(e,t,i){"use strict";cc._RF.push(t,"cb086nqYOZChKbqj42MoOcy","Resource");cc.Class({extends:cc.Component,properties:{initialHP:{default:5,tooltip:"O recurso irá começar com essa quantidade de HP"},maxHP:{default:5,tooltip:"HP máximo do recurso, não deve ser menor que Initial HP"},hp:{get:function(){return this._hp},set:function(e){e<0?this._hp=0:e>this.maxHP?this._hp=this.maxHP:this._hp=e,0<this._hp&&this.revive()},visible:!1},died:{default:!1,visible:!1}},start:function(){},init:function(e){this.game=e,this.hp=this.initialHP,this.node.setColor(cc.Color.WHITE),console.log(this.node.name+" current HP: "+this.hp)},damage:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this.hp-=e;var t=cc.sequence(cc.tintTo(.5,255,0,0),cc.tintTo(.5,255,255,255));this.node.runAction(t),0==this.hp&&this.die(),console.log(this.node.name+" current HP: "+this.hp)},die:function(){this.node.stopAllActions(),this.node.setColor(cc.Color.RED),this.died=!0,this.game.onResourceDie(this)},revive:function(){this.died&&(this.died=!1,this.game.onResourceRevived(this)),this.node.setColor(cc.Color.WHITE)}});cc._RF.pop()},{}],Spaceship:[function(e,t,i){"use strict";cc._RF.push(t,"76799cOtCFOj6IIDNqtgmm7","Spaceship");var n=e("Threat");cc.Class({extends:n,properties:{rotationSpeed:{default:100},projectilePrefab:{default:null,type:cc.Prefab}},start:function(){this._super()},init:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.game=e,this._pos=t},beginMotion:function(){var e=this.getComponent(cc.Animation);e.getClips()[this._pos].speed=this.speed,0<this._pos?e.play("motion"+this._pos):e.play("motion")},lockOn:function(e){var t=Math.atan2(e.y-this.node.y,e.x-this.node.x);return cc.radiansToDegrees(-t)+90},mirar:function(e,t){e>this.spriteNode.rotation?this.spriteNode.rotation+=this.rotationSpeed*t:e<this.spriteNode.rotation&&(this.spriteNode.rotation-=this.rotationSpeed*t)},atirar:function(){var e=cc.instantiate(this.projectilePrefab);e.getComponent("Threat").tipo="EnemyProjectile",e.getComponent("Threat").speed=100,e.getComponent("Threat").pontos=1,e.getComponent("Threat").maxHP=1,e.getComponent("Threat").hp=1,e.getComponent("Threat").target=this.target,e.runAction(cc.repeatForever(cc.rotateBy(1,360))),this.game.spawnThreat(e,this.spriteNode.getChildByName("init_pos"))},onHalfCompleted:function(){this.atirar()},onAnimCompleted:function(){this.game.onThreatDestroy(this),this.node.destroy()},update:function(e){this._super(e),this.mirar(this.lockOn(this.target.getPosition()),e)}});cc._RF.pop()},{Threat:"Threat"}],Threat:[function(e,t,i){"use strict";cc._RF.push(t,"b284bI/tjNLEqci5YLPY85d","Threat");var a=cc.Class({extends:cc.Component,properties:{speed:{default:1},target:{default:null,type:cc.Node},maxHP:{default:0,visible:!1},hp:{get:function(){return this._hp},set:function(e){e<0?this._hp=0:e>this.maxHP?this._hp=this.maxHP:this._hp=e},visible:!1},pontos:{default:0,visible:!1},tipo:{default:null,visible:!1},explosivel:{default:!1,visible:!1}},statics:{TAG_DEFENSE_FACILITY:1,TAG_POWER_PLANT:2,TAG_CITY:3,TAG_DEFENSE:4,TAG_EXPLOSION:5},onLoad:function(){this._ifPoints=cc.find("interface/points/data",this.node).getComponent(cc.Label),this.spriteNode=cc.find("sprite",this.node)},start:function(){this._inPlanetArea=!1,this._ifPoints.string=this.pontos},init:function(e){this.game=e;var t=this.target.getPosition();this.planetPos=this.game.planet.getPosition();var i=cc.pDistance(this.node.position,this.planetPos),n=cc.pDistance(this.node.position,t);this.initialTargetDistance=i;var s=n/this.speed,o=cc.moveTo(s,t),a=function(){console.log("destroyed"),this.game.onDamage(this,this.target),this.game.onThreatDestroy(this),this.node.destroy()}.bind(this),c=cc.sequence(o,cc.callFunc(a));"Asteroid"==this.tipo&&cc.find("sprite",this.node).runAction(cc.repeatForever(cc.rotateBy(5,360))),this.node.runAction(c)},onCollisionEnter:function(e,t){var i=t.node.position.x>-t.node.parent.width/2&&t.node.position.x<t.node.parent.width/2&&t.node.position.y>-t.node.parent.height/2&&t.node.position.y<t.node.parent.height/2;switch(console.log("colidiu"),console.log("GROUP: "+e.node.group),console.log("TAG: "+e.tag),console.log("PROJECTILE_COLL: "+i),console.log("THREAT_POS: X: "+t.node.position.x+" Y: "+t.node.position.y),console.log("PARENT WIDTH: "+t.node.parent.width),console.log("PARENT HEIGHT: "+t.node.parent.height),e.node.group){case"recurso":e.tag==a.TAG_DEFENSE&&t.tag!=a.TAG_EXPLOSION&&(console.log("destroyed"),this.game.onDamage(this,e),this.game.onThreatDestroy(this),this.node.destroy());break;case"projetil":if(t.tag!=a.TAG_EXPLOSION&&!t.node.exploded&&i){var n=e.node.getComponent("Projectile");this.hp-=n.dano;var s=cc.sequence(cc.tintTo(.3,255,0,0),cc.tintTo(.3,255,255,255));if(this.spriteNode.runAction(s),0==this.hp){var o=this.pontos;if("Spaceship"!=this.tipo&&"Fragment"!=this.tipo&&(o=this.getCurrentPointsAccordingToPos()),this.explosivel)cc.find("explosionFX",this.node).getComponent(cc.ParticleSystem).resetSystem(),this.getComponent(cc.Animation).play("explosion"),this.getComponent(cc.Animation).playAdditive("explosionTrace"),this.node.exploded=!0;else this.node.destroy();this.game.onThreatDestroy(this,o,n)}}break;case"ameaça":if(e.tag==a.TAG_EXPLOSION&&e.node.exploded&&(this.hp-=999,0==this.hp)){o=this.pontos;if("Spaceship"!=this.tipo&&"Fragment"!=this.tipo&&(o=this.getCurrentPointsAccordingToPos()),this.explosivel)cc.find("explosionFX",this.node).getComponent(cc.ParticleSystem).resetSystem(),this.getComponent(cc.Animation).play("explosion"),this.getComponent(cc.Animation).playAdditive("explosionTrace"),this.node.exploded=!0;else this.node.destroy();this.game.onThreatDestroy(this,o,null,!0)}break;case"area":this._inPlanetArea=!0}},onAnimExplosionColliderCommence:function(){this.getComponent(cc.CircleCollider).enabled=!0,this.spriteNode.active=!1},onAnimExplosionColliderCompleted:function(){this.node.destroy()},getCurrentPointsAccordingToPos:function(){var e=0;if(this._inPlanetArea)e=.1*this.pontos;else{var t=cc.pDistance(this.node.position,this.planetPos);e=this.pontos*(t/this.initialTargetDistance)}return e},update:function(e){"Spaceship"!=this.tipo&&"Fragment"!=this.tipo&&(this._ifPoints.string=Math.round(this.getCurrentPointsAccordingToPos()))}});cc._RF.pop()},{}],Wave:[function(e,t,i){"use strict";cc._RF.push(t,"07db1GY4sVM2qDmYJTDFGxn","Wave");e("Threat"),cc.Class({extends:cc.Component,properties:{waveData:{default:null,visible:!1},asteroidPrefab:{default:null,type:cc.Prefab},asteroidFragmentsPrefab:{default:[],type:[cc.Prefab]},virusPrefab:{default:null,type:cc.Prefab},empPrefab:{default:null,type:cc.Prefab},spaceShipPrefab:{default:null,type:cc.Prefab},cityNode:{default:null,type:cc.Node},defenseNode:{default:null,type:cc.Node},powerPlantNode:{default:null,type:cc.Node}},onLoad:function(){},start:function(){},init:function(e){this.waveData=e,this.numberOfThreats=this.waveData.threats.length,this.remainingThreats=this.numberOfThreats,this.threatsDestroyed=0,console.log("(WAVE) threats num: "+this.remainingThreats)},waveIsOver:function(){return 0==this.remainingThreats},extract:function(){return this.remainingThreats-=1,this.waveIsOver()},extractThreat:function(){var e=this.waveData.threats[this.getThreatIdx()];if(!e)return null;switch(e.tipo){case"Asteroid":var t=cc.instantiate(this.asteroidPrefab);break;case"Virus":t=cc.instantiate(this.virusPrefab);break;case"EMP":t=cc.instantiate(this.empPrefab);break;case"Spaceship":t=cc.instantiate(this.spaceShipPrefab)}switch(e.target){case"City":var i=this.cityNode;break;case"Defense":i=this.defenseNode;break;case"Power":i=this.powerPlantNode;break;case"Player":i=cc.find("Canvas/avatar")}return t.getComponent("Threat").tipo=e.tipo,t.getComponent("Threat").speed=e.speed,t.getComponent("Threat").pontos=Number(e.pontos),t.getComponent("Threat").maxHP=Number(e.hp),t.getComponent("Threat").hp=Number(e.hp),t.getComponent("Threat").explosivel=Boolean(e.explosivel),t.getComponent("Threat").target=i,t.interval=e.interval,t.shipPos=Number(e.shipPos),t.angle=Number(e.angle),this.remainingThreats-=1,t},onThreatDestroy:function(){this.threatsDestroyed++},waveDestroyed:function(){return this.threatsDestroyed>=this.numberOfThreats},getThreatIdx:function(){return this.numberOfThreats-this.remainingThreats}});cc._RF.pop()},{Threat:"Threat"}]},{},["Defense","Drone","Fragment","Main","Pierce","Projectile","Resource","Spaceship","Threat","Wave","InterScenes","LevelItem","MainLS"]);